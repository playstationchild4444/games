<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Minesweeper</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; display:flex; flex-direction:column; align-items:center; padding:20px; }
    #board { display: inline-grid; gap: 2px; margin-top: 12px; }
    button.cell {
      width: 34px;
      height: 34px;
      padding: 0;
      line-height: 34px;
      text-align: center;
      font-size: 14px;
      cursor: pointer;
      border: 2px ridge #bbb;
      background: #f0f0f0;
      user-select: none;
    }
    button.cell:disabled { cursor: default; }
    #controls { margin-bottom: 8px; }
  </style>
</head>
<body>
  <div id="controls">
    <label>Rows: <input id="rows" type="number" value="16" min="5" max="40" style="width:60px"></label>
    <label>Cols: <input id="cols" type="number" value="16" min="5" max="40" style="width:60px"></label>
    <label>Mines: <input id="mines" type="number" value="60" min="1" max="600" style="width:70px"></label>
    <button id="newGame">New Game</button>
  </div>

  <div id="board"></div>

  <script>
    // Configuration (can be changed via controls above)
    let ROWS = 16, COLS = 16, MINES = 60;

    let grid = [];
    let revealed = [];
    let buttons = [];
    let gameOver = false;
    let firstClick = true;

    const boardEl = document.getElementById('board');
    const rowsInput = document.getElementById('rows');
    const colsInput = document.getElementById('cols');
    const minesInput = document.getElementById('mines');
    const newGameBtn = document.getElementById('newGame');

    newGameBtn.addEventListener('click', () => {
      ROWS = Math.max(5, parseInt(rowsInput.value) || 16);
      COLS = Math.max(5, parseInt(colsInput.value) || 16);
      MINES = Math.max(1, Math.min(ROWS*COLS-1, parseInt(minesInput.value) || 60));
      startGame();
    });

    function startGame() {
      // reset state
      grid = Array.from({length: ROWS}, () => Array.from({length: COLS}, () => 0));
      revealed = Array.from({length: ROWS}, () => Array.from({length: COLS}, () => false));
      buttons = Array.from({length: ROWS}, () => Array.from({length: COLS}, () => null));
      gameOver = false;
      firstClick = true;

      // build board UI
      boardEl.style.gridTemplateColumns = `repeat(${COLS}, auto)`;
      boardEl.innerHTML = '';
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const btn = document.createElement('button');
          btn.className = 'cell';
          btn.dataset.row = r;
          btn.dataset.col = c;
          btn.addEventListener('click', () => clickCell(r, c));
          // prevent context menu default (so right click doesn't open menu)
          btn.addEventListener('contextmenu', (e) => e.preventDefault());
          boardEl.appendChild(btn);
          buttons[r][c] = btn;
        }
      }

      plantMines();
    }

    function plantMines() {
      let planted = 0;
      while (planted < MINES) {
        const r = Math.floor(Math.random() * ROWS);
        const c = Math.floor(Math.random() * COLS);
        if (grid[r][c] !== -1) {
          grid[r][c] = -1;
          planted++;
        }
      }
    }

    function getAdjacentMines(r, c) {
      let count = 0;
      for (let i = Math.max(0, r-1); i <= Math.min(ROWS-1, r+1); i++) {
        for (let j = Math.max(0, c-1); j <= Math.min(COLS-1, c+1); j++) {
          if (grid[i][j] === -1) count++;
        }
      }
      return count;
    }

    function clickCell(r, c) {
      if (gameOver) return;

      if (firstClick) {
        firstClick = false;
        // Reveal 3x3 area around first click (no recursion)
        for (let i = Math.max(0, r-1); i <= Math.min(ROWS-1, r+1); i++) {
          for (let j = Math.max(0, c-1); j <= Math.min(COLS-1, c+1); j++) {
            if (!revealed[i][j]) {
              const adj = getAdjacentMines(i, j);
              revealed[i][j] = true;
              const btn = buttons[i][j];
              btn.disabled = true;
              btn.textContent = adj === 0 ? '' : String(adj);
              btn.style.backgroundColor = adj === 0 ? 'green' : 'lightgray';
              btn.style.color = adj > 0 ? 'red' : 'black';
            }
          }
        }
      }

      // If clicked mine, reveal all and end game
      if (grid[r][c] === -1) {
        revealAll();
        gameOver = true;
        alert("Game Over: You hit a mine!");
        return;
      }

      if (revealed[r][c]) return;

      revealed[r][c] = true;
      const adj = getAdjacentMines(r, c);
      const btn = buttons[r][c];
      btn.disabled = true;
      btn.textContent = adj === 0 ? '' : String(adj);
      btn.style.backgroundColor = adj === 0 ? 'green' : 'lightgray';
      btn.style.color = adj > 0 ? 'red' : 'black';

      if (adj === 0) {
        revealAdjacent(r, c);
      }

      // Check win: all non-mines revealed
      let won = true;
      for (let i = 0; i < ROWS; i++) {
        for (let j = 0; j < COLS; j++) {
          if (grid[i][j] !== -1 && !revealed[i][j]) {
            won = false;
            break;
          }
        }
        if (!won) break;
      }
      if (won) {
        gameOver = true;
        alert("You Win! Congratulations!");
      }
    }

    function revealAdjacent(r, c) {
      for (let i = Math.max(0, r-1); i <= Math.min(ROWS-1, r+1); i++) {
        for (let j = Math.max(0, c-1); j <= Math.min(COLS-1, c+1); j++) {
          if (!revealed[i][j] && grid[i][j] !== -1) {
            // call the same function as clicking, but it will not re-enter recursion if cell is already revealed
            clickCell(i, j);
          }
        }
      }
    }

    function revealAll() {
      for (let i = 0; i < ROWS; i++) {
        for (let j = 0; j < COLS; j++) {
          const btn = buttons[i][j];
          btn.disabled = true;
          if (grid[i][j] === -1) {
            btn.textContent = '*';
            btn.style.backgroundColor = 'red';
            btn.style.color = 'black';
          } else {
            const adj = getAdjacentMines(i, j);
            btn.textContent = adj === 0 ? '' : String(adj);
            btn.style.backgroundColor = 'lightgray';
            btn.style.color = adj > 0 ? 'red' : 'black';
          }
        }
      }
    }

    // initialize with defaults
    startGame();
  </script>
</body>
</html>
